name: Github Action Build PKGBUILD
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: LogAllEnv
        run : printenv
      - name: prepare to build
        run : sudo apt install wget git bc kmod libelf cpio perl tar xz -y
      - name: Build up linux-ck-uksm
        run : |
                git clone https://github.com/antman666/auto_pkgbuild
                cd auto_pkgbuild
                wget -c https://www.kernel.org/pub/linux/kernel/v5.x/linux-5.12.5.tar.xz
                wget -c https://github.com/graysky2/kernel_gcc_patch/archive/20210412.tar.gz
                wget -c http://ck.kolivas.org/patches/5.0/5.12/5.12-ck1/patch-5.12-ck1.xz
                tar -xpvf linux-5.12.5.tar.xz
                cp config linux-5.12.5/.config
                cd linux-5.12.5
                patch -p1 < ../*.patch
                sed -i -re "s/^(.EXTRAVERSION).*$/\1 = /" "../patch-5.12-ck1"
                patch -p1 < ../patch-5.12-ck1
                make -s kernelrelease > version
                make -j40 all
      - uses: ncipollo/release-action@v1.6.1
        with:
          allowUpdates: true
          tag: "5.12.5"
          artifacts: "./*/*.tar.xz"
          token: ${{ secrets.auto_pkgbuild }}
